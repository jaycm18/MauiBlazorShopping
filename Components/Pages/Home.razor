@page "/"
@inject MauiBlazorShopping.Services.ShoplistService ShoplistService

<h1>Shopping List</h1>

<EditForm Model="newItem" OnValidSubmit="AddItem">
    <InputText @bind-Value="newItem.Item" placeholder="Item Name" />
    <InputNumber @bind-Value="newItem.Amount" placeholder="Amount" />
    <button type="submit">Add</button>
</EditForm>

@if (shoplist == null || !shoplist.Any())
{
    <p>No items in the shopping list.</p>
}
else
{
    <ul>
        @foreach (var item in shoplist)
        {
            <li>
                <input type="checkbox" @bind="item.Purchased" />
                <span>@item.Item - Amount: @item.Amount</span>
                <button @onclick="() => DeleteItem(item.Id)">Delete</button>
            </li>
        }
    </ul>
}

@code {
    private List<Shoplist>? shoplist;
    private Shoplist newItem = new Shoplist { Item = string.Empty, Amount = 1, Purchased = false };

    protected override async Task OnInitializedAsync()
    {
        shoplist = await ShoplistService.GetShoplistAsync();
    }

    private async Task AddItem()
    {
        await ShoplistService.AddShoplistItemAsync(newItem);
        shoplist = await ShoplistService.GetShoplistAsync();
        newItem = new Shoplist { Item = string.Empty, Amount = 1, Purchased = false };
    }

    private async Task DeleteItem(int id)
    {
        await ShoplistService.DeleteShoplistItemAsync(id);
        shoplist = await ShoplistService.GetShoplistAsync();
    }
}
